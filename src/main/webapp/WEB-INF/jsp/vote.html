<html>
<title>
</title>
<body>
<img src="http://p1.img.cctvpic.com/uploadimg/2018/11/05/1541399476463682.png"  alt="加载图片-photo" /></br>

<div>
    <button id="getVoteData" onclick="getVoteData()">query Data</button>

    <button id="autoVote" onclick="autoVote()">auto Vote</button>

    <button id="stopVote" onclick="stopVote()">stop Vote</button><br/>

</div>

<div id="voteResult"></div>


<div id="content">


</div>




<script type="text/javascript" language="javascript" src="jquery-3.3.1.min.js"></script>

<script>
    function getVoteData(){
        var url_get = 'http://app1.vote.cctv.com/viewVoteAction.do?rand=' + Math.random();
        $.ajax({
            url:url_get,
            data:{
                "voteId":"15714",
                "type":"json",
                "refresh":1,
                "itemposi":'group',
                "fmt":'jsfunc'
            },
            type:'get',
            dataType:'jsonp',
            crossDomain: true,
            jsonpCallback:'voteJson15714',
            success:function(data){
                var len = data.itemGroups['0'].voteItems;
                len.sort(compare("voteNum"));
                var str = "";
                for(var i = 0;i<len.length;i++){
//                    str+='<li class="only_td"><a href="'+len[i].nameLink+'"><div class="listImg">';
//                    str+='<img src="'+len[i].imageLink+'"></div><div class="listTit">';
//                    str+='<h3>'+len[i].name+'</h3><p>'+len[i].showName+'</p></div></a>';
//                    // str+='<h3>'+len[i].name+'</h3></div></a>';
//                    str+='<div class="zan" onclick="javascript:clickOnly('+len[i].id+','+data.vote.id+','+i+');">';
//                    str+='<span class="item_num" id="voteItem_201728" >'+len[i].voteNum+'</span></div></li>';
//                    console.log("姓名："+len[i].name+";当前票数："+len[i].voteNum);
                    str+='<h3>'+len[i].name+"     "+len[i].voteNum+'</h3>';
                }
                $("#content").html(str);
                console.log(data);
            }
        });
    }

    var t;
    function autoVote(){
        $("#voteResult").html("Result:Initialization"+"---Number of success:"+successTimes+"---Number of fail:"+failTimes+"---time:"+new Date());
        t = window.setInterval(clickVote,11000);
    }

    function stopVote(){
        window.clearTimeout(t);
    }

    var successTimes = 0;
    var failTimes = 0;
    function clickVote(){
        var idd = '201733';
        var voteid = '15714';
        var url_make = 'http://app2.vote.cntv.cn/makeClickAction.do?rand=' + Math.random();
        if((successTimes + failTimes)%1 == 0){
            console.log("刷新排名...");
            getVoteData();
        }
        $.ajax({
            url:url_make,
            data:{
                "type":"jsonp",
                "voteId":voteid,
                "items_1131740":idd
            },
            type:'get',
            dataType:'jsonp',
            crossDomain: true,
            // jsonpCallback:'aa',
            success:function(data){
                if(data.message=='success'){
                    successTimes = successTimes + 1;
                    console.log("success:"+data.message);
                }else{
                    failTimes = failTimes + 1;
                    console.log("fail:"+data.message);
                }
                $("#voteResult").html("Result:"+data.message+"---Number of success:"+successTimes+"---Number of fail:"+failTimes+"---time:"+new Date());
            },
            error:function(XMLHttpRequest, textStatus, errorThrown){
                failTimes = failTimes + 1;
                $("#voteResult").html("Result:"+errorThrown+"---Number of success:"+successTimes+"---Number of fail:"+failTimes+"---time:"+new Date());
                console.log("fail:"+errorThrown);
            }
        });
    }

    function compare(propertyName) {
        return function(object1, object2) {
            var value1 = object1[propertyName];
            var value2 = object2[propertyName];
            if (value2 < value1) {
                return -1;
            } else if (value2 > value1) {
                return 1;
            } else {
                return 0;
            }
        }
    }

</script>
</body>

</html>